---
icon: akar-icons:node-fill
---

# Node.js

Node.js deployment is the default Nitro preset.

## Node.js Server

**Preset:** `node-server` ([switch to this preset](/deploy/#changing-the-deployment-preset))

::alert{type="info"}
**Default Preset**
:br
This is the default nitro output preset for production builds.
::


Build project using nitro CLI:

```bash
nitro build
```

When running `nitro build` with the Node server preset, the result will be an entry point that launches a ready-to-run Node server. To try output:

```bash
$ node .output/server/index.mjs
Listening on http://localhost:3000
```

You can now deploy fully standalone `.output` directory to the hosting of your choice.

### Environment Variables

You can customize server behavior using following environment variables:

- `NITRO_PORT` or `PORT` (defaults to `3000`)
- `NITRO_HOST` or `HOST`
- `NITRO_SSL_CERT` and `NITRO_SSL_KEY` - if both are present, this will launch the server in HTTPS mode. In the vast majority of cases, this should not be used other than for testing, and the Nitro server should be run behind a reverse proxy like nginx or Cloudflare which terminates SSL.
- `NITRO_SHUTDOWN` - Enables the graceful shutdown feature when set to `'true'`. If it's set to `'false'`, the graceful shutdown is bypassed to speed up the development process. Defaults to `'false'`.
- `NITRO_SHUTDOWN_SIGNALS` - Allows you to specify which signals should be handled. Each signal should be separated with a space. Defaults to `'SIGINT SIGTERM'`.
- `NITRO_SHUTDOWN_TIMEOUT` - Sets the amount of time (in milliseconds) before a forced shutdown occurs. Defaults to `'30000'` milliseconds.
- `NITRO_SHUTDOWN_FORCE` - When set to true, it triggers `process.exit()` at the end of the shutdown process. If it's set to `'false'`, the process will simply let the event loop clear. Defaults to `'true'`.

## Cluster mode

**Preset:** `node-cluster` ([switch to this preset](/deploy/#changing-the-deployment-preset))

For more performance and leveraging multi core handling, you can use cluster preset.

### Environment Variables

In addition to `node-server` environment variables, you can customize behavior:

- `NITRO_CLUSTER_WORKERS`: Number of cluster workers (default is Number of available cpu cores)


## Handler (advanced)

**Preset:** `node` ([switch to this preset](/deploy/#changing-the-deployment-preset))

Nitro also has a more low-level preset that directly exports a function with `(req, res) => {}` signature usable for middleware and custom servers.

When running `nitro build` with the Node preset, the result will be an entry point exporting a function with the `(req, res) => {}` signature.

**Example:**

```js
import { createServer } from 'node:http'
import handler from './.output/server'

const server = createServer(handler)
server.listen(8080)
```

## IIS

You can either use [IISnode](https://github.com/Azure/iisnode) (recommended for Nuxt) or IIS directly.
Make sure that [node.js](https://nodejs.org/en/) is installed on your Windows Server.

### Using IISnode

IISnode supports SSR build, but requires configuration required

Install [IISnode x64](https://github.com/azure/iisnode/releases/download/v0.2.21/iisnode-full-v0.2.21-x64.msi) or [IISnode x86](https://github.com/azure/iisnode/releases/download/v0.2.21/iisnode-full-v0.2.21-x86.msi), and the [IIS URL Rewrite Module](https://www.iis.net/downloads/microsoft/url-rewrite).

Run `npm run build` to generate the `.output` folder and add a `web.config` file into the `.output` folder

```xml
<?xml version="1.0" encoding="utf-8"?>
<configuration>
  <system.webServer>
    <webSocket enabled="false" />
    <handlers>
      <add name="iisnode" path="index.js" verb="*" modules="iisnode"/>
    </handlers>
    <rewrite>
      <rules>
        <rule name="NodeInspector" patternSyntax="ECMAScript" stopProcessing="true">
          <match url="^server\/debug[\/]?" />
        </rule>

        <rule name="StaticContent">
          <action type="Rewrite" url="public{REQUEST_URI}"/>
        </rule>

        <rule name="DynamicContent">
          <conditions>
            <add input="{REQUEST_FILENAME}" matchType="IsFile" negate="True"/>
          </conditions>
          <action type="Rewrite" url="index.js"/>
        </rule>
      </rules>
    </rewrite>

    <security>
      <requestFiltering>
        <hiddenSegments>
          <remove segment="bin"/>
          <add segment="node_modules"/>
        </hiddenSegments>
      </requestFiltering>
    </security>

    <httpErrors existingResponse="PassThrough" />

    <iisnode watchedFiles="web.config;*.js" node_env="production" debuggingEnabled="true" />
  </system.webServer>
</configuration>
```

Add an `index.js` file into the root of the `.output` folder with the following content:

```js
import('./server/index.mjs');
```

Deploy the contents of your `.output` folder to your website in IIS.

```bash
+-- server
|   +-- chunks
|   +-- node_modules
|   +-- index.mjs
|   +-- index.mjs.map
|   +-- package.json
+-- public
|   +-- _nuxt
+-- index.js
+-- nitro.json
+-- web.config
```

In IIS, add `.mjs` as a new mime type and set its content type to `application/javascript`.

### Using IIS

If you do not wish to use IISnode, you can use IIS directly.
Install the `HttpPlatformHandler` IIS Module. This module manages HTTP Listeners and acts as a proxy.
Add a `web.config` to the `.output` directory after the build. It should look like this:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<configuration>
  <system.webServer>
    <handlers>
      <add name="httpPlatformHandler" path="*" verb="*" modules="httpPlatformHandler" resourceType="Unspecified" requireAccess="Script" />
    </handlers>
    <httpPlatform stdoutLogEnabled="true" stdoutLogFile=".\logs\node.log" startupTimeLimit="20" processPath="C:\Program Files\nodejs\node.exe" arguments=".\server\index.mjs">
      <environmentVariables>
        <environmentVariable name="PORT" value="%HTTP_PLATFORM_PORT%" />
        <environmentVariable name="NODE_ENV" value="Production" />
      </environmentVariables>
    </httpPlatform>
  </system.webServer>
</configuration>
```

Additional `environmentVariables` can be added accordingly.

Finally, copy your `.output` directory into the Windows Server, and create a website on IIS pointing to that exact directory.